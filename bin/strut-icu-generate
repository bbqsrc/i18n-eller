#!/usr/bin/env node

"use strict"

const program = require("commander")
const fs = require("fs")
const yaml = require("js-yaml")
const pkg = require("../package.json")
const { write } = require("../lib")

program
  .version(pkg.version)
  .usage("[options] <target> <base> [langs...]")
  .arguments("<target> <base> [langs...]")
  .option("-o, --output [dir]", "Desired output path")
  .action((target, base, langs) => {
    const gen = require(`${__dirname}/../lib/targets/${target}`)
    const data = {}

    const baseLang = base.split("/").pop().split(".")[0]
    data[baseLang] = yaml.safeLoad(fs.readFileSync(base, "utf8"))

    for (const lang of langs) {
      const key = lang.split("/").pop().split(".")[0]
      data[key] = yaml.safeLoad(fs.readFileSync(lang, "utf8"))
    }

    gen(baseLang, data, program.output || ".").then(out => {
      write(program.output || ".", out)
    }).catch(err => {
      console.error(err.stack)
      process.exit(1)
    })
    
  })
  .parse(process.argv)

if (process.argv.length < 3) {
  program.help()
}
